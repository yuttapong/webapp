!function(t){t.fn.multipleInput=function(e){return l[e]?l[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.multipleInput"),!1):l.init.apply(this,arguments)};var e={afterInit:"afterInit",afterAddRow:"afterAddRow",beforeDeleteRow:"beforeDeleteRow",afterDeleteRow:"afterDeleteRow"},i={id:null,template:null,jsTemplates:[],max:1,min:1,attributes:{},indexPlaceholder:"multiple_index"},n=!1,l={init:function(l){var u=t.extend(!0,{},i,l||{}),p=t("#"+u.id),d=p.closest("form"),c=this.selector.replace("#","");p.data("multipleInput",{settings:u,currentIndex:0}),p.on("click.multipleInput",".js-input-remove",function(e){e.stopPropagation(),a(t(this))}),p.on("click.multipleInput",".js-input-plus",function(e){e.stopPropagation(),r(t(this))});var f=0,v=t.Event(e.afterInit),m=setInterval(function(){if("object"==typeof d.data("yiiActiveForm")){var e=d.yiiActiveForm("find",c),i={enableAjaxValidation:!1,validateOnBlur:!1,validateOnChange:!1,validateOnType:!1,validationDelay:500};"object"==typeof e&&(t.each(e,function(t,e){-1==["id","input","container"].indexOf(t)&&(i[t]=e)}),d.yiiActiveForm("remove",c)),t.each(u.attributes,function(e,n){n=t.extend({},i,n),u.attributes[e]=n}),p.data("multipleInput").settings=u,p.find(".multiple-input-list").find("input, select, textarea").each(function(){o(t(this))}),p.data("multipleInput").currentIndex=s(p),n=!0,clearInterval(m),p.trigger(v)}else f++;(0===d.length||f>10)&&(p.data("multipleInput").currentIndex=s(p),n=!1,clearInterval(m),p.trigger(v))},100)},add:function(e){r(t(this),e)},remove:function(e){var i=null;i=void 0!=e?t(this).find(".js-input-remove:eq("+e+")"):t(this).find(".js-input-remove").last(),a(i)},clear:function(){t(".js-input-remove").each(function(){a(t(this))})},option:function(e,i){i=i||null;var n=t(this).data("multipleInput"),l=n.settings;if(null===i){if(!l.hasOwnProperty(e))throw new Error('Option "'+e+'" does not exist');return l[e]}l.hasOwnProperty(e)&&(l[e]=i,n.settings=l,t(this).data("multipleInput",n))}},r=function(i,l){var r=t(i).closest(".multiple-input").first(),a=r.data("multipleInput"),u=a.settings,d=u.template,c=r.children(".multiple-input-list").first();if(!(null!=u.max&&s(r)>=u.max)){if(d=d.replaceAll("{"+u.indexPlaceholder+"}",a.currentIndex),t(d).hide().appendTo(c).fadeIn(300),l instanceof Object){var f=[];for(var v in l)l.hasOwnProperty(v)&&f.push(l[v]);l=f}var m;for(var h in u.jsTemplates)m=u.jsTemplates[h].replaceAll("{"+u.indexPlaceholder+"}",a.currentIndex).replaceAll("%7B"+u.indexPlaceholder+"%7D",a.currentIndex),window.eval(m);var I=0;t(d).find("input, select, textarea").each(function(){var e=t(this),i=e.get(0).tagName,r=p(e),a=t("#"+r);if(l){var u=l[I];if("INPUT"==i||"TEXTAREA"==i)a.val(u);else if("SELECT"==i)if(u&&-1!=u.indexOf("option"))a.append(u);else{var s=a.find('option[value="'+u+'"]');s.length&&a.val(u)}}n&&o(e),I++}),r.data("multipleInput").currentIndex++;var g=t.Event(e.afterAddRow);r.trigger(g)}},a=function(i){var l=i.closest(".multiple-input").first(),r=i.closest(".multiple-input-list__item"),a=l.data("multipleInput"),o=a.settings;if(s(l)>o.min){var p=t.Event(e.beforeDeleteRow);if(l.trigger(p,[r]),p.result===!1)return;n&&r.find("input, select, textarea").each(function(){u(t(this))}),r.fadeOut(300,function(){t(this).remove(),p=t.Event(e.afterDeleteRow),l.trigger(p,[r])})}},o=function(e){var i=p(e);if(null!==i){var n=t("#"+i),l=n.closest(".multiple-input").first(),r=n.closest("form");if(0!=l.length&&"undefined"==typeof r.yiiActiveForm("find",i)){var a=l.data("multipleInput"),o=i.replace(/-\d/,"").replace(/-\d-/,"");r.yiiActiveForm("add",t.extend({},a.settings.attributes[o],{id:i,input:"#"+i,container:".field-"+i}))}}},u=function(){var e=p(t(this));if(null!==e){var i=t("#"+e).closest("form");0!==i.length&&i.yiiActiveForm("remove",e)}},p=function(t){var e=t.attr("id");return"undefined"==typeof e&&(e=t.data("id")),"undefined"==typeof e?null:e},s=function(t){return t.children(".multiple-input-list").children("tbody").children(".multiple-input-list__item").length};String.prototype.replaceAll=function(t,e){return this.split(t).join(e)}}(window.jQuery);