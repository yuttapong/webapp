<?php/** * Created by PhpStorm. * User: Noom * Date: 25/8/2559 * Time: 11:04 */use backend\modules\qtn\RequestAsset;use kartik\typeahead\Typeahead;use yii\helpers\Url;use yii\bootstrap\Html;use yii\jui\Sortable;use yii\widgets\ActiveForm;$form = ActiveForm::begin([    'id' => 'other-form',    'action' => ['response/form-others'],    'enableAjaxValidation' => false,    'enableClientValidation' => true,]);$itemsRes = [];if ($modelsOther) {    foreach ($modelsOther as $index => $modelOther) {        $html = "<p>";        $html .= '<div class="row">';        $html .= "<div class='col-xs-11 col-sm-11 col-md-11'>";        $html .= Html::hiddenInput("other[other_id][]", $modelOther->other_id, ['class' => 'form-control']);        $html .= Html::textInput("other[response][]", $modelOther->response, ['class' => 'form-control']);        $html .= '</div>';        $html .= "<div class='col-xs-1 col-sm-1 col-md-1'>";        $html .= Html::button('x', ['class' => 'removeItemOther btn btn-xs btn-danger']);        $html .= "</div>";        $html .= "</div>";        $html .= "</p>";        $itemsRes[] = ['content' => $html];    }}?><div class="row">    <div class="col-xs-12 col-sm-12">    </div></div><div class="item panel panel-default">    <div class="panel-heading">        <p><strong class="model-title"><?= $modelQuestion->name ?></strong></p>        <div class="row">            <div class="col-xs-10 col-sm-10 col-md-10">                <?php                echo Typeahead::widget([                    'name' => 'searching',                    'options' => ['placeholder' => 'พิมพ์ค้นหา ...', 'id' => 'other-text'],                    'pluginOptions' => ['highlight' => true],                    'dataset' => [                        [                            'datumTokenizer' => "Bloodhound.tokenizers.obj.whitespace('value')",                            'display' => 'name',                            'remote' => [                                'url' => Url::to(['other-list']) . '?q=%QUERY',                                'wildcard' => '%QUERY'                            ]                        ]                    ],                    'pluginEvents' => [                        "typeahead:select" => 'function(index,item){                      var btnDel = "<button type=\"button\" class=\"remove-res btn btn-xs btn-danger\" onclick=\"$(this).parent().parent().remove();\">x</button>";                      var res = $("#list-other");                      console.log(item);                      var li = "<li></p>";                      li+= "<div class=\"row\">";                      li+= "<div class=\"col-xs-11 col-sm-11 col-md-11\">";                      li+= "<input type=\"hidden\" name=\"other[other_id][]\" value=\""+item.id+"\">";                      li+= "<input type=\"hidden\" name=\"other[response][]\" class=\"form-control readonly\" value=\""+item.name+"\">";                      li+= item.name;                      li+= "</div>";                      li+= "<div class=\"col-xs-1 col-sm-1 col-md-1\">"+btnDel+"</div>";                      li+= "</div>";                      li+= "</p></li>"                      res.append(li);		                      $(this).typeahead(\'val\',\'\');                      }',]                ]);                ?>            </div>            <div class="col-xs-2 col-sm-2 col-md-2">                <?= Html::button('+', ['class' => 'addItemOther btn btn-success']) ?>            </div>        </div>    </div>    <div class="panel-body">        <?= Sortable::widget([            'items' => $itemsRes,            'options' => ['tag' => 'ul', 'id' => 'list-other', 'class' => 'list-unstyled'],            'itemOptions' => ['tag' => 'li'],            'clientOptions' => ['cursor' => 'move'],        ]);        ?>    </div></div><div class="form-group">    <?= Html::hiddenInput("responseId", $responseId) ?>    <?= Html::hiddenInput("questionId", $modelQuestion->id) ?>    <?= Html::hiddenInput("choiceId", $modelChoice->id) ?>    <?= Html::Button('บันทึก', ['class' => 'btn btn-primary', 'id' => 'btn-save-other']) ?></div><?php ActiveForm::end(); ?><script>    $(".removeItemOther").on('click', function () {        console.log('remove');        $(this).parent().parent().remove();    });    $(".addItemOther").on('click', function () {        var title = $("#other-text");        console.log('add :', title);        var li = '<li><p><div class="row">';        li += '<div class="col-xs-11">';        li += '<input type="hidden" name="other[other_id][]" class="form-control" value="0">';        li += '<input type="text" name="other[response][]" class="form-control" style="color:green;" value="' + title.val() + '">';        li += '</div>';        li += '<div class="col-xs-1">';        li += '<button type="button" class="remove-res btn btn-danger btn-xs" onclick="$(this).parent().parent().remove();">x</button>';        li + '</div>';        li += '</div></p></li>';        if (title.val()) {            $(li).appendTo("#list-other");            title.val("");        }    });    $('#btn-save-other').click(function () {        $.ajax({            url: 'save-other',            type: 'post',            dataType: 'json',            data: $('#other-form').serialize(),            success: function (rs) {                console.log(rs);                var show = $("#show-others-" + rs.choiceId);                show.html('');                var li = '';                if (rs.success) {                    $.each(rs.others, function (index, val) {                        console.log(val.title);                        li += '<li>' + val.title + '</li>';                    });                    show.append('<ul>' + li + '</ul>');                    $("#modall-view").modal('hide');                    $("#choice-" + rs.choiceId).prop('checked', true);                }            }        });    });</script>