<?php/** * Created by PhpStorm. * User: RB * Date: 20/8/2559 * Time: 10:30 */use kartik\form\ActiveForm;use kartik\helpers\Html;use backend\modules\crm\SurveyAsset;use yii\widgets\Pjax;SurveyAsset::register($this);use yii\jui\JuiAsset;use richardfan\sortable\SortableGridView;use yii\helpers\Url;JuiAsset::register($this);?><?php Pjax::begin()?><div class="col-xs-12 col-xm-6 col-md-6"><?phpecho  \yii\grid\GridView::widget([    'dataProvider' =>  $searchQ,    'rowOptions' => function ($model, $key, $index, $grid) {        return ['data-sortable-id' => $model->id];    },    'columns' => [        ['class' => 'yii\grid\SerialColumn'],        'id',        'name',        'seq',        [            'class' => yii\grid\ActionColumn::className(),            'template' => '{edit-topic}',            'buttons' => [                'edit-topic' => function ($url, $model) {                    return Html::a('<span class="fa fa-edit"></span>', $url , ['class' => 'view', 'data-pjax' => '0']);                },            ],        ],    ],    'options' => [        'data' => [            'sortable-widget' => 1,            'sortable-url' => \yii\helpers\Url::toRoute(['sorting']),        ]    ],]);?></div><div class="col-xs-12 col-xm-6 col-md-6"></div><?php Pjax::end()?><hr><?php$form = ActiveForm::begin([    'type' => ActiveForm::TYPE_HORIZONTAL,    'id' => 'form-survey',    'options' => [    ],]);foreach ($model->questions as  $questionIndex =>  $question) {    $choices = [];    $no = $questionIndex+1 .') '.$question->type->type;    $topic = $form->field($question,"[{$questionIndex}]name")->textInput(['class'=>'form-control'])->label($no);   // $choices = '';    $buttonAddChoice = '<div align="right"><button type="button" data-q="'.$question->id.'" class="btn btn-xs btn-success">';    $buttonAddChoice .= '<i class="fa fa-plus"></i>  เพิ่ม Choice</button></div>';     $questionChoices = $question->questionChoices;     foreach ($questionChoices as  $choiceIndex => $choice){         $choices[] =  [           'content' =>  Html::activeInput("text",$choice,"[{$questionIndex}][{$choiceIndex}]content",['value'=>$choice->content,'class'=>'form-control'])         ];     }    $choicesSort =  \kartik\sortable\Sortable::widget([        'items' =>$choices,        'showHandle'=>true,    ]);    $items[] = [        'content' => "{$topic} <div id=\"containter-choice-{$question->id}\">{$choicesSort}</div><br>{$buttonAddChoice}",    ];}  \kartik\sortable\Sortable::widget([    'items' => $items,   // 'showHandle'=>true,   // 'itemOptions'=>['class'=>'disabled'],    ]);//echo Html::submitButton('submit',['class'=>'btn btn-primary']);ActiveForm::end();?><?=SortableGridView::widget([    'dataProvider' => $searchQ,    //'filterModel' => $searchQ,    'sortUrl' => Url::to(['sortItem']),    'sortingPromptText' => 'กำลังประมวลผล...',    'failText' => 'ไม่สามารถเรียงลำดับได้',    'columns' => [        ['class' => 'yii\grid\SerialColumn'],        'id',        'name',        'seq',        [            'class' => yii\grid\ActionColumn::className(),            'template' => '{edit-topic}',            'buttons' => [                'edit-topic' => function ($url, $model) {                    return Html::a('<span class="fa fa-edit"></span>', $url , ['class' => 'view', 'data-pjax' => '0']);                },            ],        ],        ['class' => 'yii\grid\ActionColumn'],    ],]); ?>