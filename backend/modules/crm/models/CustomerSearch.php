<?phpnamespace backend\modules\crm\models;use Yii;use yii\base\Model;use yii\data\ActiveDataProvider;use backend\modules\crm\models\Customer;/** * CustomerSearch represents the model behind the search form about `backend\modules\crm\models\Customer`. */class CustomerSearch extends Customer{    public function rules()    {        return [            [['id', 'age'], 'integer'],            [['prefixname', 'firstname', 'lastname', 'birthday', 'mobile', 'email', 'tel'], 'safe'],        ];    }    public function scenarios()    {        // bypass scenarios() implementation in the parent class        return Model::scenarios();    }    public function search($params)    {        $query = Customer::find();        $dataProvider = new ActiveDataProvider([            'query' => $query,            'sort'=> ['defaultOrder' => ['id'=>SORT_DESC]]        ]);        $query->where(['active'=>Customer::STATUS_ACTIVE]);        // ถ้าดูไม่ได้ทุกทายการ        if( ! Yii::$app->user->can('/crm/customer/all')){            //            if(Yii::$app->user->can('/crm/customer/mylead')){            }else{                $query->andFilterWhere(['created_by'=>Yii::$app->user->id]);            }        }        if (!($this->load($params) && $this->validate())) {            return $dataProvider;        }        $query->andFilterWhere([            'id' => $this->id,            'birthday' => $this->birthday,            'age' => $this->age,        ]);        $query->andFilterWhere(['like', 'prefixname', $this->prefixname])            ->andFilterWhere(['like', 'firstname', $this->firstname])            ->andFilterWhere(['like', 'lastname', $this->lastname])            ->andFilterWhere(['like', 'mobile', $this->mobile])            ->andFilterWhere(['like', 'email', $this->email])            ->andFilterWhere(['like', 'tel', $this->tel]);        return $dataProvider;    }    public function searchMylead($params)    {        $query = Customer::find();        $dataProvider = new ActiveDataProvider([            'query' => $query,            'sort'=> ['defaultOrder' => ['id'=>SORT_DESC]]        ]);        $query->where(['active'=>Customer::STATUS_ACTIVE]);        if( Yii::$app->user->can('/crm/customer/mylead')){            $query->andFilterWhere(['person_in_charge'=>Yii::$app->user->id]);        }        if (!($this->load($params) && $this->validate())) {            return $dataProvider;        }        $query->andFilterWhere([            'id' => $this->id,            'birthday' => $this->birthday,            'age' => $this->age,        ]);        $query->andFilterWhere(['like', 'prefixname', $this->prefixname])            ->andFilterWhere(['like', 'firstname', $this->firstname])            ->andFilterWhere(['like', 'lastname', $this->lastname])            ->andFilterWhere(['like', 'mobile', $this->mobile])            ->andFilterWhere(['like', 'email', $this->email])            ->andFilterWhere(['like', 'tel', $this->tel]);        return $dataProvider;    }}